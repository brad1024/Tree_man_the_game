<html>
	<head>
		<title>
			Tree_man_the_game

		</title>
		<!-- local file below -->
		<!-- ==================================== -->
		<!--our css file -->
		<link rel='stylesheet' href='Style.css'>

	

		<!-- module below-->
		<!-- ==================================== -->
		<!-- jquery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<!-- future socket.io here --> 
		<!--<script src="/socket.io/socket.io.js"></script>-->
		<script src="/socket.io/socket.io.js"></script>
    	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		

		<!-- bootsrap-->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
		<!-- vue.js
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>

		<script type="text/javascript" src="vue-app.js"></script>
			-->

		<!-- ==================================== -->


		<script>
			var TURN = -1;  //第一次player_turn 會解鎖 button 
			var PLAYER_ID = 0 ; 
			let socket = io();
			var Env = null;

			//message
			var num_message = 0; 
			var MAX_MESSAGE = 19; 
			function addMessage(Text){
				if(num_message>= MAX_MESSAGE){
					$("#message div:nth-child(1)").remove();
				}

				if(num_message %2 ==0){
					$("#message").append("<div class=\"message_div\" style=\"background-color:#F5FFFA;\">"+Text+"</div>");
				} 
				else{
					$("#message").append("<div class=\"message_div\" style=\"background-color:#DCDCDC\">"+Text+"</div>");
				}
				num_message+=1;
			}
			
			//選擇玩家 socket  ==============================================================================
			socket.on("welcome",(player1HasBeenChoosen , player2HasBeenChoosen  )=>{ //when start,hide the main page to let player select charcters.
						
						if(player1HasBeenChoosen){
							$("#pl1").attr('disabled',true);
							$("#pl1").text("player1 has been choosed");
						}
						
						if(player2HasBeenChoosen){
							$("#pl2").attr('disabled',true);
							$("#pl2").text("player2 has been choosed");
						}

						$(".LEFT").hide();
						$(".RIGHT").hide();


						
				})

			socket.on("player_choosed", (id)=>{ 
				
						if(id==1){
							
							$("#pl1").attr('disabled',true);
							$("#pl1").text("player2 has been choosed");
							
						}else if(id==-1){
							$("#pl2").attr('disabled',true);
							$("#pl2").text("player2 has been choosed");
							
						}
				})

			socket.on("start_game",()=>{
				$("button").attr('disabled', true);
				round = 1;
				$("#choose_player").hide();
				$(".detail_choose").hide();
				//放入玩家名
				if(PLAYER_ID == 1){
					$("#player_name").text("player id:1");
				}
				else{
					$("#player_name").text("player id:2");
				}

				$(".LEFT").show();
				$(".RIGHT").show();
				
				/*
				$("#my_item_2").hide();
				$("#my_item_content_2").hide();
				$("#item_sub_accept_1").hide();
				$("#item_sub_accept_2").hide();
				$("#item_sub_deny").hide();
				$("#action_pray").hide(); */
			})	
			
			socket.on("player_turn" , ()=>{
				TURN *= -1;
				
				if(TURN == PLAYER_ID){
					$("button").attr('disabled', false);
				}
				else{
					$("button").attr('disabled', true);
				}
				$("#go-back").attr("disabled", false);
				
			})
			
			//========  ==============================================================================	

			socket.on("update_state", (env)=>{  //更新狀態
				Env = env;


				// 基本數值更新區
				$("#round").text(env.round);
				$("#east_hp").text(env.roads["E"].wallhp);
				$("#wood").text(env.wood);
				$("#south_hp").text(env.roads["S"].wallhp);
				$("#west_hp").text(env.roads["W"].wallhp);
				$("#north_hp").text(env.roads["N"].wallhp);
				

				$("#num_archer").text(env.num_of_troop["archer"]);
				$("#num_armor").text(env.num_of_troop["armor"]);
				$("#num_ranger").text(env.num_of_troop["ranger"]);
				// ========================================================================================
				
				// progress bar 調整
				$("#W-wall-bar").css("width" , (env.roads["W"].wallhp*100/env.maxWallhp).toString()  + "%");
		
				$("#W-wall-bar").text( (env.roads["W"].wallhp*100/env.maxWallhp).toString() + "%" );

				$("#E-wall-bar").css("width" , (env.roads["E"].wallhp*100/env.maxWallhp).toString()  + "%");
				$("#E-wall-bar").text( (env.roads["E"].wallhp*100/env.maxWallhp).toString() + "%");

				$("#N-wall-bar").css("width" , (env.roads["N"].wallhp*100/env.maxWallhp).toString()  + "%");
				$("#N-wall-bar").text( (env.roads["N"].wallhp*100/env.maxWallhp).toString()  + "%");

				$("#S-wall-bar").css("width" , (env.roads["S"].wallhp*100/env.maxWallhp).toString()  + "%");
				$("#S-wall-bar").text( (env.roads["S"].wallhp*100/env.maxWallhp ).toString() + "%");
				// ========================================================================================
			}
			)

			// jQuery , 按鈕與互動
			$(document).ready(()=>{
				//選擇玩家 按鈕 ========================
				$("#pl1").click(()=>{
					PLAYER_ID = 1;
					$("#pl1").hide();
					$("#pl2").hide();
					$("#pl").text("你是玩家1");
					socket.emit("choose_character", 1);
				});
				$("#pl2").click(()=>{
					PLAYER_ID = -1;
					$("#pl1").hide();
					$("#pl2").hide();
					$("#pl").text("你是玩家2");
					socket.emit("choose_character", -1);
				});
				//========  ==============================================================================	
				
				// id :  1 : archer , 2 : armor
				$("#choose_troop_move").click(()=>{
					 $("#choose_basic_action").hide();
					 $("#troop_move").show();
					 $("#go-back").show();
				}
				)

				$("#choose_recruit_troop").click(()=>{
					$("#choose_basic_action").hide();
					$("#recruit_troop").show();
					$("#go-back").show();

				})
				
				$("#choose_repair_wall").click(()=>{
					$("#choose_basic_action").hide();
					$("#repair_wall").show();
					$("#go-back").show();
    
				})
	            
				$("#go-back ").click(()=>{
					$(".detail_choose").hide();
					$("#choose_basic_action").show();
				})
				//========  ==============================================================================	
				
				// recruit_troop wall button ====================================================================
				$(".recruit_troop").click(function(e){

					troop_type = e.target.id;
					troop_name = "沒有";
					class recruit_troop {
						constructor(troop_type){
							this.type ='recruit';
							this.troop_type = troop_type ;
						}
					}
					can_recruit = true;
					if(troop_type == "archer" && Env.wood >= 1000  ){
						action = new recruit_troop(troop_type);
						troop_name= "弓箭";
						
					}
					else if(troop_type == "armor" && Env.wood >= 500  ){
						action = new recruit_troop(troop_type);
						troop_name="重甲步兵";
					}
					else if(troop_type == "ranger" && Env.wood >= 2000 ){
						action = new recruit_troop(troop_type);
						troop_name="騎兵";
					}
					else{
						addMessage("你沒有足夠的木頭招募士兵");
						can_recruit=false;
					}
					
					if(can_recruit){
						addMessage("你招募了一隊"+troop_name+"隊!");
						socket.emit("action_done" , PLAYER_ID , action);
					}
					
				})

				//========  ==============================================================================	

				// repair wall button ====================================================================
				$(".repair_wall ").click(function(e){
					dir = e.target.id
					class repair_wall {
						constructor(dir,unit){
							this.type ='repair_wall';
							this.direction =  dir;
							this.unit = unit ;
						}
					}
					action = new repair_wall(dir,2);

					socket.emit("action_done" , PLAYER_ID , action);
				})
	
				//========  ==============================================================================	


				})
		</script>



	</head>
	
	




	<body>
   
	<!-- 選角畫面 ======================          -->
	<div id="choose_player">
	<img src="title.PNG" >
	<div style="text-align: center">
		<p id="pl">請選擇角色</p>
		<button class="btn btn-info" id="pl1">player1</button>
		  <button class="btn btn-info" id="pl2">player2</button>
		</div>
	</div>
	<!-- ======================================  -->



	<div class="LEFT">
	
	

    <!-- our status showing below-->
	<!-- ==================================== -->
	<div class="LEFT_TOP">
		<!--屬性欄，此div為最外框-->
    	<div id="status" > <div>當前狀態 <span id="player_name"> </span> </div>   
			<div id="my_basic-data">
				<!--基本數值-->
				<div>你堅守了<span id="round"> 1 </span>天</div>
				<div> 內政狀態</div>
				<div>木頭: <span id="wood">500 </span> </div>


				<div> 城牆狀態</div>
				<div>東: <span id="east_hp"> 1000</span> </div>

				<div class="progress">
					<div id="E-wall-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="70"
					aria-valuemin="0" aria-valuemax="100" style="width:70%">
					  70%
					</div>
				</div>
	

				<div>南: <span id="south_hp"> 1000 </span> </div>
				
				<div class="progress">
					<div id="S-wall-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="70"
					aria-valuemin="0" aria-valuemax="100" style="width:70%">
					  70%
					</div>
				</div>
	


				<div>西: <span id="west_hp"> 1000 </span> </div>
				<div class="progress">
					<div id="W-wall-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="70"
					aria-valuemin="0" aria-valuemax="100" style="width:70%">
					  70%
					</div>
				</div>
	
				<div>北: <span id="north_hp"> 1000 </span> </div>
				<div class="progress">
					<div id="N-wall-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="70"
					aria-valuemin="0" aria-valuemax="100" style="width:70%">
					  70%
					</div>
				</div>
	


				<div>軍隊狀態</div>
				<div>弓箭隊:    <span id="num_archer"> 1 </span>    隊         </div>
				<div>重步兵隊:    <span id="num_armor"> 0 </span>   隊          </div>
				<div>騎兵隊:    <span id="num_ranger"> 0 </span>    隊         </div>
			</div>		

        </div> <!-- id=LEFT_TOP closing tag , this section ending here-->

	<!-- all status showing above-->
	<!-- ==================================== -->

	
	
        </div><!-- id=status closing tag , this section ending here-->
	<!-- all status showing above-->
	<!-- ==================================== -->


	

	<!-- all buttons or something user interaction below-->
	<!-- ==================================== -->
	<div class="LEFT_BOTTOM">
		
			<div id="my_mission">操作</div>
			
			<div id = "choose_basic_action">
			你這回合選擇

			<button class="choice_button btn btn-dark" id="choose_troop_move">轉守為攻!!</button>
			<button class="choice_button btn btn-dark" id="choose_recruit_troop">招募士兵</button>
			<button class="choice_button btn btn-dark" id="choose_repair_wall">修築城牆</button>

		    </div>

			<div class= "detail_choose" id = "troop_move">  轉守為攻!!
				
			</div>
			<!--  招募士兵  -->
			<div class= "detail_choose" id = "recruit_troop"> 
				<div>選擇招募兵種  </div>  
				<div  > <button  class="recruit_troop" id="archer" >弓箭隊</button>   </div>
				<div > <button class="recruit_troop" id="armor" >重甲步兵隊</button> </div>
			    <div > <button  class="recruit_troop" id="ranger"> 騎兵隊 </button>  </div>
			
			
			
			</div>
			<!--   =======================================   -->			
			
			<!--   修城牆  -->
			<div class= "detail_choose" id = "repair_wall">  
				<div>選擇修補方向  </div>  
				<div  > <button  class="repair_wall" id="E" >東</button>  </div>
				<div > <button class="repair_wall" id="S" >南</button> </div>
			    <div > <button  class="repair_wall" id="W">西</button>  </div>
				<div > <button class="repair_wall" id="N" >北</button>  </div>
			</div>
			<button class="detail_choose" , id="go-back"> 返回</button>
			<!--   =======================================   -->
			



	</div>

	</div>
	<div class="RIGHT">
	<!-- show message below--> 
			<!-- ==================================== -->
			
			<div id="message">message
		

			</div>
			
			
			<!-- show message above--> 
			<!-- ==================================== -->

	</div> 



</body>


</html>
